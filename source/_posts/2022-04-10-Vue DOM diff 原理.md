---
layout: default
title: Vue DOM Diff 原理
description: Vue
categories: [Vue]
tags: [Vue]
---
# {{ page.title }}

## 一.创建虚拟DOM --- h方法

## 二.初次渲染 --- 根据虚拟DOM创建真实DOM元素，并挂载到真实root上

## 三.dom diff

### 1.如果type不同，老的dom直接替换成新生成的dom

### 2.相同的type（type相同，dom不重新创建，只更新属性，这样节省性能）

#### a：老或新，至少有一个没有children的情况

1. 老的有children，新的没有children，更新属性后，直接删掉老的children
2. 老的没children，新的有children，更新属性后，直接添加新的children


#### b： 老的有children，新的也有children，要递归比较children

都有children情况，老和新的比较方法整体顺序：

##### 1：先比较开始位置

先比较新和老的第一个孩子，如果相同（key 和 type相同则认为相同），比较第二个，直到比较完成，新的还有的话，把新的插入到老的后面（相当于后面新增元素）

##### 2：再比较结束位置

如果第一个孩子不同，从新和老的末尾开始比较，如果末尾相同，接下来比较倒数第二个，老的没有孩子后，新的还有，把新的依次插入到老的最前面（相当于前面新增元素）

##### 3：再比较老的结束位置与新的开始位置

开始位置，结束位置都不同的情况，会把老的结束位置与新的开始位置相比较，接下来老的位置左移（-1）和新的位置右移（+1）比较（相当于把老的头部一个诺到了末尾）

##### 4：再比较老的开始位置和新的结束位置

以上都不同的情况，老的开始位置与新的结束位置比较，相同的话，把老的开始的dom移动到尾部，老的位置右移与新的结束位置左移进行比较（相当于老的尾部挪到了头部一个）

##### 5：完全无规律状态比较

以上完全没规律，比对不上的情况下，用新的第一个和每一个老的相比，都不一样插入到最前面，然后新的指针右移，重新进行一遍头头、尾尾、尾头、头尾的比较，再比对不上再新的当前项和老的每一项相比，比对上了就把老的dom移动到新的指针位位置，接着新的和老的都指针右移，继续重复整体顺序的比对，如果新的都比对完了，老的还有，就把老的剩下的删除掉，就结束了



